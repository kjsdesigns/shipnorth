#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîí Running configuration enforcement checks..."

# Run config enforcement test
npx playwright test tests/e2e/config-enforcement.spec.ts --timeout=30000

if [ $? -ne 0 ]; then
    echo ""
    echo "‚ùå COMMIT REJECTED: Configuration violations detected!"
    echo ""
    echo "üö® HARDCODED PORTS/URLS FOUND IN YOUR CHANGES"
    echo ""
    echo "MANDATORY FIXES REQUIRED:"
    echo "1. Move ALL configuration to .env file"
    echo "2. Replace hardcoded values with process.env.VARIABLE_NAME"
    echo "3. Follow centralized configuration patterns in CLAUDE.md"
    echo ""
    echo "EXAMPLES:"
    echo "‚ùå const PORT = 8850;"
    echo "‚úÖ const PORT = process.env.API_PORT;"
    echo ""
    echo "‚ùå 'http://localhost:8849'"
    echo "‚úÖ \`http://localhost:\${process.env.WEB_PORT}\`"
    echo ""
    echo "Run: npm run test:config-enforcement"
    echo "Fix all violations, then commit again."
    echo ""
    exit 1
fi

echo "‚úÖ Configuration enforcement passed - no hardcoded values detected"

# Run other pre-commit checks
npm run lint --silent
npm run typecheck --silent